<div transition:fade id="postWrap" class="content is-medium">
{#if details}
  <h1 id="post" style="background-color:{colors.color1}">{details[1].menu}</h1>
{/if}



<div class="content is-large desc">
	{#if lessonTags}
		{#each lessonTags as tag}
		<span on:click="scrollTag(tag.id)" class="tag">
			{tag.text}
		</span>
		{/each}
	{/if}

	{#if details[0] == 'event'} 
	<div class='lesson'>
		
		<iframe sandbox='allow-forms allow-scripts' src='https://www.tickettailor.com/events/allsaintschurch' frameBorder='0' ></iframe>
		
		</div>
	{:else}
	<section >{@html desc}</section>
	{/if}

</div>

<!-- <h2>Research More...</h2>
{#if details}
<ol>
	<li><a href="{details[1].mdn}" target="_blank">{details[1].mdn}</a></li>
	{#each details[1].links as link}
		<li><a href="{link}" target="_blank">{link}</a></li>
	{/each}
</ol>
{/if} -->
	
</div>

<style>
iframe {
	width: 100%;
	height: 100vh;
}

blockquote {
	border-bottom-right-radius:4px;
	border-bottom-left-radius:4px;
	text-align: initial;
}
blockquote::before {
	content: 'â˜¼';
	font-size: 4rem;
}
#postWrap {
	padding-top:50px;
	padding-bottom:50px;
}

ol > li {
	font-size: 1.5rem;
	word-spacing: 5px;
    letter-spacing: .5px;
}

h1 {
		padding: 10px;
		padding-left: 50px;
		color:  white;
		border-radius: 0px;
		border-top-right-radius: 20px;
    /* border-bottom-right-radius: 20px; */
		margin-bottom:0;
		margin-top: 5px;
		box-shadow: 2px 2px 15px #ccc;
		-webkit-text-fill-color: white;
    -webkit-text-stroke-width: 1px;
    -webkit-text-stroke-color: black;
    -webkit-text-stroke-width: .2px;
    word-spacing: 15px;
	letter-spacing: 2px;		
	opacity: .8;
	}
h3 { 
	font-size: 2rem;
	margin-left:20px;
} 
</style> 

<script >
		import { fade } from 'svelte-transitions';		
  
 
  export default {
	transitions: { fade },
    store: () => store,
    components:{ 
	}, 
    methods: {
		scrollTag(id) {
			const elmnt = document.getElementById(id);
			elmnt.scrollIntoView();	
		},
		addH2Tags() {
			const lesson = document.getElementsByClassName('lesson')[0];
			const tags = lesson.getElementsByTagName('h2');
			let i = 0;
			let arr = [];
			for (let tag of tags) {
				let tagId = 'h2_'+i;
				tag.id = tagId;
				i++;
				arr.push({text: tag.textContent, id: tagId });	
			}
			this.set({ lessonTags: arr });
		}
    },
	computed: {
		colors: ( { $sectionColors, $id }) => {
			return $sectionColors[$id]
		},
		snips: ( { $snippets, $id } ) => {
        /* could not figure out how to chaing these ! :(  */
			  $snippets.map((snip,idx) => { 
				snip.idx = idx;
			  })
			  return $snippets.filter((snip,idx) => snip.cat === $id);
		},
		details: ({ $id, $cats }) => {
		 return $cats.filter(category => category[0] === $id)[0];
		}
	},

	oncreate() {


		const state = store.get();
		const id = state.id;
		const comp = this;
		const elmnt = document.getElementById("postWrap");
		elmnt.scrollIntoView();	

		const urly = `../posts/${ id }.html`;
		return fetch(urly).then(function(res) {
		return res.text();
			})
			.then(function(html) {
				// html = html.replace(/[\r\n\t]/g, '');
				// html = html.replace(/@@/g, '\n');
				//html = html.replace(/<\/pre>/g, '</pre><div class="cns"></div')
				comp.set({'desc':html});
				comp.addH2Tags(); 

				/* adds our bg colors to spans so we have colorful headings in sections */

				const sections = document.querySelectorAll('.lesson > p > span');
				/* section colors that are too light for white text */document
				const lightCols = ['rgb(236, 240, 32)','rgb(255, 208, 113)'];

				sections.forEach(function(section) {
					let { colors } = comp.get();
					if (!colors) colors = {};
					let col = colors.color1 || 'red'
					section.style.backgroundColor = col;

					if (lightCols.includes(col)){
						section.style.color = '#000'
					}
					//section.insertAdjacentHTML('beforeBegin', '<hr />');
				});
			});

		}
}
</script>