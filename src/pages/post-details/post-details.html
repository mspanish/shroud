<div transition:fade id="postWrap" class="content is-medium">
{#if details}
  <h1 id="post" style="background-color:{colors.color1}">{details[1].menu}</h1>
{/if}



<div class="content is-large desc">
	{#if lessonTags}
		{#each lessonTags as tag}
		<span on:click="scrollTag(tag.id)" class="tag">
			{tag.text}
		</span>
		{/each}
	{/if}

	{#if details[0] == 'event'} 
	<div class='lesson'>
	
	{@html desc} 
		</div>
	{:else}
	<section >{@html desc}</section>
	{/if}

</div>

<!-- <h2>Research More...</h2>
{#if details}
<ol>
	<li><a href="{details[1].mdn}" target="_blank">{details[1].mdn}</a></li>
	{#each details[1].links as link}
		<li><a href="{link}" target="_blank">{link}</a></li>
	{/each}
</ol>
{/if} -->
	
</div>

<style>

iframe {
	width: 100%;
	height: 100vh;
}

blockquote {
	border-bottom-right-radius:4px;
	border-bottom-left-radius:4px;
	text-align: initial;
}
blockquote::before {
	content: 'â˜¼';
	font-size: 4rem;
}
#postWrap {
	padding-top:50px;
	padding-bottom:50px;
}

ol > li {
	font-size: 1.5rem;
	word-spacing: 5px;
    letter-spacing: .5px;
}

h1 {
		padding: 10px;
		padding-left: 50px;
		color:  white;
		border-radius: 0px;
		border-top-right-radius: 20px;
    /* border-bottom-right-radius: 20px; */
		margin-bottom:0;
		margin-top: 5px;
		box-shadow: 2px 2px 15px #ccc;
		-webkit-text-fill-color: white;
    -webkit-text-stroke-width: 1px;
    -webkit-text-stroke-color: black;
    -webkit-text-stroke-width: .2px;
    word-spacing: 15px;
	letter-spacing: 2px;		
	opacity: .8;
	}
h3 { 
	font-size: 2rem;
	margin-left:20px;
} 

</style> 

<script >
		import { fade } from 'svelte-transitions';		
  
 
  export default {
	transitions: { fade },
    store: () => store,
    components:{ 
	}, 
    methods: {
		scrollTag(id) {
			const elmnt = document.getElementById(id);
			elmnt.scrollIntoView();	
		},
		addH2Tags() {
			const lesson = document.getElementsByClassName('lesson')[0];
			const tags = lesson.getElementsByTagName('h2');
			let i = 0;
			let arr = [];
			for (let tag of tags) {
				let tagId = 'h2_'+i;
				tag.id = tagId;
				i++;
				arr.push({text: tag.textContent, id: tagId });	
			}
			this.set({ lessonTags: arr });
		},
		checkForArticles(id,articles) {
			if (id == 'articles') {
				
				let tbody = document.getElementById('articles');

				for (let article of articles) {
		
					let row = `<tr>
						<td><a  href="${ article.url }" target="_blank">${ article.title }</a></td>
						<td>${ article.author}</td>
						<td>${ article.cat}</td>
					</tr>`;
					tbody.insertAdjacentHTML('beforeend', row);
				}
			}			
		},
		checkForVideos(id,videos) {
			if (id == 'videos') {
					
					let tbody = document.getElementById('videos');

					for (let video of videos) {
			
						let row = `<tr>
							<td><a href="${ video.url }" target="_blank"><img class="videoThumb" src="../img/${ video.img }.png"/></a></td>
							<td><a href="${ video.url }" target="_blank"> ${ video.title }</a></td>
							<td>${ video.platform}</td>
							<td class="small">${ video.length}</td>
							<td>${ video.price}</td>
						</tr>`;
						tbody.insertAdjacentHTML('beforeend', row);
					}
				}			
		}		
    },
	computed: {
		colors: ( { $sectionColors, $id }) => {
			return $sectionColors[$id]
		},
		snips: ( { $snippets, $id } ) => {
        /* could not figure out how to chaing these ! :(  */
			  $snippets.map((snip,idx) => { 
				snip.idx = idx;
			  })
			  return $snippets.filter((snip,idx) => snip.cat === $id);
		},
		details: ({ $id, $cats }) => {
		 return $cats.filter(category => category[0] === $id)[0];
		}
	},

	oncreate() {

		

		const videos = [
			{img: 'russ', url: 'https://shroudstory.com/2014/12/14/russ-breault-the-shroud-of-turin-in-fifteen-minutes/', title: ' Russ Breault on the Shroud of Turin', platform: 'youtube', length: '15 minutes', price: 'free'},
			{img: 'barrie', url: 'https://shroudstory.com/2013/05/03/barrie-schwortz-tedx-via-della-conciliazione-talk/', title: 'Barrie Schwortz Ted Talk', platform: 'youtube', length: '14 minutes', price: 'free'},
			{img: 'face', url: 'https://vimeo.com/47220836', title: 'The Real Face of Jesus - History Channel', platform: 'vimeo', length: '90 minutes', price: 'free'},
			{img: 'unwrap', url: 'https://www.youtube.com/watch?v=YWyiZtagxX8', title: 'Unwrapping The Shroud of Turin New Evidence - Discovery Channel', platform: 'vimeo', length: '43 minutes', price: 'free'},

		];
		const articles = [
		{ url: 'http://shroud.com/', title: 'Shroud of Turin site', author: 'Barrie Schwortz', cat: 'news & articles'},
			{ url: 'https://manoftheshroud.wordpress.com/', title: 'Man of the Shroud', author: 'White & Mangum', cat: 'podcast & blog'},
			{ url: 'https://shroudstory.com', title: 'Shroud Story', author: 'Dan Porter', cat: 'blog'},
		]		
		const state = store.get();
		const id = state.id;
		console.log('dawg id is '+id)
		console.log('id is '+id)

		const comp = this;
		const elmnt = document.getElementById("postWrap");
		elmnt.scrollIntoView();	

		const urly = `../posts/${ id }.html`;
		return fetch(urly).then(function(res) {
		return res.text();
			})
			.then(function(html) {
				// html = html.replace(/[\r\n\t]/g, '');
				// html = html.replace(/@@/g, '\n');
				//html = html.replace(/<\/pre>/g, '</pre><div class="cns"></div')
				comp.set({'desc':html});
				comp.addH2Tags(); 

				/* adds our bg colors to spans so we have colorful headings in sections */

				const sections = document.querySelectorAll('.lesson > p > span');
				/* section colors that are too light for white text */document
				const lightCols = ['rgb(236, 240, 32)','rgb(255, 208, 113)'];

				sections.forEach(function(section) {
					let { colors } = comp.get();
					if (!colors) colors = {};
					let col = colors.color1 || 'red'
					section.style.backgroundColor = col;

					if (lightCols.includes(col)){
						section.style.color = '#000'
					}
					//section.insertAdjacentHTML('beforeBegin', '<hr />');
				});

				comp.checkForArticles(id,articles);
				comp.checkForVideos(id,videos);
			});
	       

		}  // end oncreate()
}
</script>