<div transition:fade id="postWrap" class="content is-medium">

<h1>Category: </h1>

 <span class="follow btn-nav tb_buttons tb_note"><Link href="../notebook">go to notebook</Link></span>

 <span class="follow btn-nav tb_buttons tb_note"><Link href="../authors">all authors</Link></span>
	

</div>

<style>

iframe {
	width: 100%;
	height: 100vh;
}

blockquote {
	border-bottom-right-radius:4px;
	border-bottom-left-radius:4px;
	text-align: initial;
}
blockquote::before {
	content: '☼';
	font-size: 4rem;
}
#postWrap {
	padding-top:50px;
	padding-bottom:50px;
}

ol > li {
	font-size: 1.5rem;
	word-spacing: 5px;
    letter-spacing: .5px;
}

h1 {
		padding: 10px;
		padding-left: 50px;
		color:  black;
		border-radius: 0px;
		border-top-right-radius: 20px;
    /* border-bottom-right-radius: 20px; */
		margin-bottom:0;
		margin-top: 5px;
		/* box-shadow: 2px 2px 15px #ccc; */
		-webkit-text-fill-color: black;
    -webkit-text-stroke-width: 1px;
    -webkit-text-stroke-color: black;
    -webkit-text-stroke-width: .2px;
    word-spacing: 15px;
	letter-spacing: 2px;		
	opacity: .8;
	display:inline-block;
	}
h3 { 
	font-size: 2rem;
	margin-left:20px;
} 
.posting {
	word-break:break-word;
	padding-top:10px;
	padding-bottom:10px;
	border-bottom: solid 1px #ccc;
	font-family: 'Montserrat', sans-serif;
}

td {
	font-family: 'Montserrat', sans-serif;
}

</style> 

<script >
		import { fade } from 'svelte-transitions';		
		import { startCase, saveToNotebook } from '../../utilities.js';
		import Link from '../../components/Link.html';
		import { Toast, deleteAllToasts} from '../../toaster-js/index.js';   
  

  export default {
	transitions: { fade },
    store: () => store,
    components:{ Link
	}, 
    methods: {
		search() {
			let input = document.getElementById('searchy');
			input = input.value.toLowerCase();
		
			let rows = document.querySelectorAll('#posts > tr');
			let ct = 0;
			for (let row of rows) {
				let str = row.textContent.toLowerCase();
				if (str.includes(input)){
					ct++;
				}
				if (!str.includes(input)){
					row.style.display = 'none';
				}
				if (!input) {
					row.style.display = 'table-row';

				}
			}
			let count = document.getElementById('searchCt');
			count.textContent = "found "+ct+ ' posts.'
			if (!input) count.textContent = '';
		},
		favorite(id) {
			id = id.replace(/ /g, '_').toLowerCase();
			let favs = localStorage.getItem('favorites') || [];
			if (favs && favs.length > 0) favs = JSON.parse(favs);
			let contains = false;
			favs.map(element => {
				if (element == id){
				  contains = true;
				  let st = id+ ' is already in your favorites!'
					new Toast(st,'toast','error')		
				}
			})
			if (contains) return
			favs.push(id);
			store.set({favorites: favs})
			localStorage.setItem('favorites', JSON.stringify(favs));
			let st = 'saved '+id+ ' to your favorite authors.'
        	new Toast(st,'toast','info')
		},
		moveTo(id) {
			let elmnt = document.getElementById(id);
			elmnt.scrollIntoView();	
		},
		saveData(type,cat,post,x) {
			saveToNotebook(type,cat,post,x);
		},
		addParagraphBreaks(post) {
			let comp = this;
		//	let postings = document.getElementsByClassName('posting');
			//console.log('got postings? '+postings)
			let j = 0;

			const authorsArr  = ['david', 'hugh', 'dan', 'colin', 'yannick', 'charles', 'daveb', 'max', 'stephen', 'mario', 'mark', 'antonio', 'john', 'giulio', 'louis', 'anoxie', 'dave', 'kelly', 'barry', 'barrie', 'russ', 'joe', 'colinsberry', 'ron'];
			const scholars = ['barbet','rucker','zugibe', 'wesselow', 'piczak', 'piczek', 'benford','vignon', 'bucklin', 'marino','rolfe', 'meacham', 'fanti', 'rogers', 'adler', 'heller', 'mccrone', 'jackson', 'strup', 'enea']
			const shroudWords = ['pray', 'codex', 'tomb', 'cloth', 'textile', 'shroud', 'woven', 'ancient', 'formation', 'pollen', 'dna']
			const bloodWords = ['blood', 'bloodstains', 'bloodstain', 'bloody', 'wounds'];
			const holyWords = ['christ', 'yeshua','jesus', 'god', 'holy', 'spirit', 'trinity', 'lord', 'lords']
			return alterPost(post);
			
			
			function alterPost(str) { 
				//console.log('altering: '+str)
			//	if (j > postings.length-1) return
//			for (let posting of postings) {
	
			//	let str = post  // postings[j].textContent.replace(/\\n/g, '');
				//console.log(str)
			
				let arr = [];

				let words = str.split(' ');
			
				//let result = this.chunkArray(str, 50);
				let newStr = '';
				let lines = [];

				let i = 0; // for lines
				let e = 0; // for words
				let z = 0;
		
				
				for (let word of words) {
					// fix people like Charles Freeman who are always adding commas w/ no space after them...
					word = word.replace(/,[s]*/g, ", ");

					let line = lines[i] || '';	
					//console.log(word)
					if (authorsArr.includes(word.trim().toLowerCase().replace('-','').replace('“', '').replace(',', '').replace('.', ''))) {
						word = '<span class="authorName">'+word+'</span>';
					}
					if (scholars.includes(word.trim().toLowerCase().replace('“', '').replace('’s', '').replace(',', '').replace('.', ''))) {
						word = '<span class="scholars">'+word+'</span>';
					}


					if (bloodWords.includes(word.trim().toLowerCase().replace('“', '').replace(',', '').replace('.', ''))) {
						word = '<span class="blood">'+word+'</span>';
					}

					if (shroudWords.includes(word.trim().toLowerCase().replace('“', '').replace(',', '').replace('.', ''))) {
						word = '<span class="shroud">'+word+'</span>';
					}
	
					if (holyWords.includes(word.trim().toLowerCase().replace('“', '').replace(',', '').replace('.', '').replace('’s', ''))) {
						word = '<span class="holy">'+word+'</span>';
					}				

					line = line + ' ' + word;
					lines[i] = line;
					e++
					if (e > 50 && word.includes('.') || e > 50 && word.includes('!')) {
						e = 0;
						//console.log("\n\nGOT A HIT")
						i++;
					}
				}
				for (let line of lines) {
					//console.log(line)
					line = comp.urlify(line);
					newStr = newStr + '<p>'+line+'</p>'
				}
				return newStr;
			//	postings[j].innerHTML =  newStr;
			//	j++
				
				// setTimeout(() => {
				// 	alterPost(j);
				// }, 50);
			
			}
		},
		urlify(text) {
			let urlRegex = /(((https?:\/\/)|(www\.))[^\s]+)/g;
			//var urlRegex = /(https?:\/\/[^\s]+)/g;
			return text.replace(urlRegex, function(url,b,c) {
			
			let url2 = (c == 'www.') ?  'http://' +url : url;
				url2 = url2.replace(')', '').replace('(', '')
			
				return '<a href="' +url2.toLowerCase()+ '" target="_blank">' + url.toLowerCase() + '</a>';
			}) 
		},
		chunkArray(myArray, chunk_size){
			var index = 0;
			var arrayLength = myArray.length;
			var tempArray = [];

			for (let index = 0; index < arrayLength; index += chunk_size) {
		
				let myChunk = myArray.slice(index, index+chunk_size);
				// Do something if you want with the group
				
				tempArray.push(myChunk);
			}

			return tempArray;
		}
    },
	computed: {
		author_name: ( { $id }) => {
		let name = $id.replace(/_/g, ' ')
			name = startCase(name).replace('%c3%a9', 'é');
		return name 
		}
	},

	oncreate() {
		let right = document.getElementsByClassName('right')[0];
		if (right) console.log('GOT RIGHT')
		right.style.backgroundColor = '#f1ebda';
		right.style.backgroundImage = 'none';
		right.classList.remove('has-background-white-ter')
		const state = store.get();
		const id = state.id;
		console.log('dawg id is '+id)
		console.log('id is '+id)

		const comp = this;


		}  // end oncreate()
}
</script>